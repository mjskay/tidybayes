<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Data and Geoms for Bayesian Models • tidybayes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Tidy Data and Geoms for Bayesian Models">
<meta property="og:description" content="Compose data for and extract, manipulate, and visualize posterior draws from Bayesian models (JAGS, Stan, rstanarm, brms, MCMCglmm, coda, ...) in a tidy data format. Functions are provided to help extract tidy data frames of draws from Bayesian models and that generate point summaries and intervals in a tidy format. In addition, ggplot2 geoms and stats are provided for common visualization primitives like points with multiple uncertainty intervals, eye plots (intervals plus densities), and fit curves with multiple, arbitrary uncertainty bands.">
<meta property="og:image" content="https://mjskay.github.io/tidybayes/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93322-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93322-5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tidybayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/tidybayes.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/tidy-brms.html">Extracting and visualizing tidy draws from brms models</a>
    </li>
    <li>
      <a href="articles/tidy-posterior.html">Using tidybayes with the posterior package</a>
    </li>
    <li>
      <a href="articles/tidy-rstanarm.html">Extracting and visualizing tidy draws from rstanarm models</a>
    </li>
    <li>
      <a href="articles/tidybayes-residuals.html">Extracting and visualizing tidy residuals from Bayesian models</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mjskay/tidybayes/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="tidybayes-bayesian-analysis--tidy-data--geoms">tidybayes: Bayesian analysis + tidy data + geoms<a class="anchor" aria-label="anchor" href="#tidybayes-bayesian-analysis--tidy-data--geoms"></a>
</h1></div>
<p><a href="https://github.com/mjskay/tidybayes/actions" class="external-link"><img src="https://github.com/mjskay/tidybayes/workflows/R-CMD-check/badge.svg" alt="R build status"></a> <a href="https://codecov.io/github/mjskay/tidybayes?branch=master" class="external-link"><img src="https://codecov.io/gh/mjskay/tidybayes/branch/master/graph/badge.svg" alt="Coverage status"></a> <a href="https://cran.r-project.org/package=tidybayes" class="external-link"><img src="https://www.r-pkg.org/badges/version/tidybayes" alt="CRAN status"></a> <img src="https://cranlogs.r-pkg.org/badges/last-month/tidybayes" alt="Download count"><a href="https://zenodo.org/badge/latestdoi/33396684" class="external-link"><img src="https://zenodo.org/badge/33396684.svg" alt="DOI"></a></p>
<figure><img src="reference/figures/preview.gif" alt="Preview of tidybayes plots"><figcaption aria-hidden="true">
Preview of tidybayes plots
</figcaption></figure><p><a href="https://mjskay.github.io/tidybayes/">tidybayes</a> is an R package that aims to make it easy to integrate popular Bayesian modeling methods into a tidy data + ggplot workflow. It builds on top of (and re-exports) several functions for visualizing uncertainty from its sister package, <a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></p>
<p><a href="https://dx.doi.org/10.18637/jss.v059.i10" class="external-link">Tidy</a> data frames (one observation per row) are particularly convenient for use in a variety of R data manipulation and visualization packages. However, when using Bayesian modeling functions like JAGS or Stan in R, we often have to translate this data into a form the model understands, and then after running the model, translate the resulting sample (or predictions) into a more tidy format for use with other R functions. <code>tidybayes</code> aims to simplify these two common (often tedious) operations:</p>
<ul>
<li><p><strong>Composing data</strong> for use with the model. This often means translating data from a <code>data.frame</code> into a <code>list</code> , making sure <code>factors</code> are encoded as numerical data, adding variables to store the length of indices, etc. This package helps automate these operations using the <code><a href="reference/compose_data.html">compose_data()</a></code> function, which automatically handles data types like <code>numeric</code>, <code>logical</code>, <code>factor</code>, and <code>ordinal</code>, and allows easy extensions for converting other data types into a format the model understands by providing your own implementation of the generic <code><a href="reference/data_list.html">as_data_list()</a></code>.</p></li>
<li><p><strong>Extracting tidy draws</strong> from the model. This often means extracting indices from parameters with names like <code>"b[1,1]"</code>, <code>"b[1,2]"</code> into separate columns of a data frame, like <code>i = c(1,1,..)</code> and <code>j = c(1,2,...)</code>. More tediously, sometimes these indices actually correspond to levels of a factor in the original data; e.g. <code>"x[1]"</code> might correspond to a value of <code>x</code> for the first level of some factor. We provide several straightforward ways to convert draws from a variable with indices into useful long-format (“<a href="https://dx.doi.org/10.18637/jss.v059.i10" class="external-link">tidy</a>”) data frames, with automatic back-conversion of common data types (factors, logicals) using the <code><a href="reference/spread_draws.html">spread_draws()</a></code> and <code><a href="reference/spread_draws.html">gather_draws()</a></code> functions, including automatic recovery of factor levels corresponding to variable indices. In most cases this kind of long-format data is much easier to use with other data-manipulation and plotting packages (e.g., <code>dplyr</code>, <code>tidyr</code>, <code>ggplot2</code>) than the format provided by default from the model. See <code><a href="articles/tidybayes.html">vignette("tidybayes")</a></code> for examples.</p></li>
</ul>
<p><code>tidybayes</code> also provides some additional functionality for data manipulation and visualization tasks common to many models:</p>
<ul>
<li><p><strong>Extracting tidy fits and predictions</strong> from models. For models like those provided by <code>rstanarm</code> and <code>brms</code>, <code>tidybayes</code> provides a tidy analog of the <code><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">posterior_epred()</a></code>, <code><a href="https://mc-stan.org/rstantools/reference/posterior_predict.html" class="external-link">posterior_predict()</a></code>, and <code><a href="https://mc-stan.org/rstantools/reference/posterior_linpred.html" class="external-link">posterior_linpred()</a></code> functions, called <code><a href="reference/add_predicted_draws.html">add_epred_draws()</a></code>, <code><a href="reference/add_predicted_draws.html">add_predicted_draws()</a></code>, and <code><a href="reference/add_predicted_draws.html">add_linpred_draws()</a></code>. These functions are modeled after the <code><a href="https://modelr.tidyverse.org/reference/add_predictions.html" class="external-link">modelr::add_predictions()</a></code> function, and turn a grid of predictions into a long-format data frame of draws from either the fits or predictions from a model. These functions make it straightforward to generate arbitrary fit lines from a model. See <code><a href="articles/tidy-brms.html">vignette("tidy-brms")</a></code> or <code><a href="articles/tidy-rstanarm.html">vignette("tidy-rstanarm")</a></code> for examples.</p></li>
<li><p><strong>Summarizing posterior distributions</strong> from models. <code>tidybayes</code> re-exports the <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">ggdist::point_interval()</a></code> family of functions (<code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">median_qi()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">mean_qi()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">mode_hdi()</a></code>, etc), which are methods for generating point summaries and intervals that are designed with tidy workflows in mind. They can generate point summaries plus an arbitrary number of probability intervals <em>from</em> tidy data frames of draws, they <em>return</em> tidy data frames, and they <strong>respect data frame groups</strong>. <code>tidybayes</code> also provides and implementation of <code><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">posterior::summarise_draws()</a></code> for use with grouped data frames, such as those returned by the <code>tidybayes::XXX_draws</code> functions.</p></li>
<li>
<p><strong>Visualizing priors and posteriors</strong>. The focus on tidy data makes the output from tidybayes easy to visualize using <code>ggplot</code>. While existing <code>geom</code>s (like <code>ggdist::geom_pointrange()</code> and <code>ggdist::geom_linerange()</code>) can give useful output, the output from <code>tidybayes</code> is designed to work well with several geoms and stats in its sister package, <code>ggdist</code>. These geoms have sensible defaults suitable for visualizing posterior point summaries and intervals (<code><a href="http://mjskay.github.io/ggdist/reference/geom_pointinterval.html" class="external-link">ggdist::geom_pointinterval()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">ggdist::stat_pointinterval()</a></code>), visualizing distributions with point summaries and intervals (the <code><a href="http://mjskay.github.io/ggdist/reference/ggdist-deprecated.html" class="external-link">ggdist::stat_sample_slabinterval()</a></code> family of stats, including eye plots, half-eye plots, CCDF bar plots, gradient plots, dotplots, and histograms), and visualizing fit lines with an arbitrary number of uncertainty bands (<code><a href="http://mjskay.github.io/ggdist/reference/geom_lineribbon.html" class="external-link">ggdist::geom_lineribbon()</a></code> and <code><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">ggdist::stat_lineribbon()</a></code>). Priors can also be visualized in the same way using the <code><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">ggdist::stat_slabinterval()</a></code> family of stats. The <code><a href="http://mjskay.github.io/ggdist/reference/geom_dotsinterval.html" class="external-link">ggdist::geom_dotsinterval()</a></code> family also automatically finds good binning parameters for dotplots, and can be used to easily construct quantile dotplots of posteriors (see example in this document). For convenience, <code>tidybayes</code> re-exports the <code>ggdist</code> stats and geoms.</p>
<figure><p><img src="reference/figures/slabinterval_family.png" alt="The slabinterval family of geoms and stats"></p>
<figcaption aria-hidden="true"><p>The slabinterval family of geoms and stats</p>
</figcaption></figure><p>See <code><a href="http://mjskay.github.io/ggdist/articles/slabinterval.html" class="external-link">vignette("slabinterval", package = "ggdist")</a></code> for more information.</p>
</li>
<li><p><strong>Extracting and visualizing data frames of random variables</strong> from models. <code>tidybayes</code> also provides <code>XXX_rvars</code> functions as alternatives to the <code>XXX_draws</code> functions, such as <code><a href="reference/spread_rvars.html">spread_rvars()</a></code>, <code><a href="reference/add_predicted_rvars.html">add_predicted_rvars()</a></code>, etc. These functions instead return tidy data frames of <code><a href="https://mc-stan.org/posterior/reference/rvar.html" class="external-link">posterior::rvar()</a></code>s, a vectorized random variable data type (see <code><a href="https://mc-stan.org/posterior/articles/rvar.html" class="external-link">vignette("rvar", package = "posterior")</a></code> for more about <code>rvar</code>s). Combined with the <code><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">ggdist::stat_slabinterval()</a></code> and <code><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">ggdist::stat_lineribbon()</a></code> geometries, these functions make it easy to extract samples from distributions, manipulate them, and visualize them; this format may have significant advantages in terms of memory required for large models. See <code><a href="articles/tidy-posterior.html">vignette("tidy-posterior")</a></code> for examples.</p></li>
<li><p><strong>Comparing a variable across levels of a factor</strong>, which often means first generating pairs of levels of a factor (according to some desired set of comparisons) and then computing a function over the value of the comparison variable for those pairs of levels. Assuming your data is in the format returned by <code>spread_draws</code>, the <code>compare_levels</code> function allows comparison across levels to be made easily.</p></li>
</ul>
<p>Finally, <code>tidybayes</code> aims to fit into common workflows through <strong>compatibility with other packages</strong>:</p>
<ul>
<li><p>Its core functions for returning tidy data frames of draws are built on top of <code><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">posterior::as_draws_df()</a></code>.</p></li>
<li><p>Drop-in functions to translate tidy column names used by <code>tidybayes</code> to/from names used by other common packages and functions, including column names used by <code>ggmcmc::ggs</code> (via <code>to_ggmcmc_names</code> and <code>from_ggmcmc_names</code>) and column names used by <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy</a></code> (via <code>to_broom_names</code> and <code>from_broom_names</code>), which makes comparison with results of other models straightforward.</p></li>
<li><p>The <code>unspread_draws</code> and <code>ungather_draws</code> functions invert <code>spread_draws</code> and <code>gather_draws</code>, aiding compatibility with other Bayesian plotting packages (notably <code>bayesplot</code>).</p></li>
<li><p>The <code>gather_emmeans_draws</code> function turns the output from <code><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans::emmeans</a></code> (formerly <code>lsmeans</code>) into long-format data frames (when applied to supported model types, like <code>MCMCglmm</code> and <code>rstanarm</code> models).</p></li>
</ul>
<div class="section level2">
<h2 id="supported-model-types">Supported model types<a class="anchor" aria-label="anchor" href="#supported-model-types"></a>
</h2>
<p><code>tidybayes</code> aims to support a variety of models with a uniform interface. Currently supported models include <a href="https://cran.r-project.org/package=rstan" class="external-link">rstan</a>, <a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a>, <a href="https://cran.r-project.org/package=brms" class="external-link">brms</a>, <a href="https://cran.r-project.org/package=rstanarm" class="external-link">rstanarm</a>, <a href="https://cran.r-project.org/package=runjags" class="external-link">runjags</a>, <a href="https://cran.r-project.org/package=rjags" class="external-link">rjags</a>, <a href="https://cran.r-project.org/package=jagsUI" class="external-link">jagsUI</a>, <a href="https://cran.r-project.org/package=coda" class="external-link">coda::mcmc and coda::mcmc.list</a>, <a href="https://mc-stan.org/posterior/" class="external-link">posterior::draws</a>, <a href="https://cran.r-project.org/package=MCMCglmm" class="external-link">MCMCglmm</a>, and anything with its own <code>as.mcmc.list</code> implementation. If you install the <a href="https://mjskay.github.io/tidybayes.rethinking/">tidybayes.rethinking</a> package, models from the <a href="https://github.com/rmcelreath/rethinking" class="external-link">rethinking</a> package are also supported.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the currently-released version from CRAN with this R command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidybayes"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, you can install the latest development version from GitHub with these R commands:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"mjskay/tidybayes"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>This example shows the use of tidybayes with the Stan modeling language; however, tidybayes supports many other model types, such as JAGS, brm, rstanarm, and (theoretically) any model type supported by <code><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">coda::as.mcmc.list</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rvlenth.github.io/emmeans/" class="external-link">emmeans</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelr.tidyverse.org" class="external-link">modelr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/theme_ggdist.html" class="external-link">theme_tidybayes</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/panel_border.html" class="external-link">panel_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Imagine this dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">n_condition</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="va">ABC</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ABC</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">response</span>, y <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"condition"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/make_data-1.png" width="672"></p>
<p>A hierarchical model of this data might fit an overall mean across the conditions (<code>overall_mean</code>), the standard deviation of the condition means (<code>condition_mean_sd</code>), the mean within each condition (<code>condition_mean[condition]</code>) and the standard deviation of the responses given a condition mean (<code>response_sd</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n;</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_condition;</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=n_condition&gt; condition[n];</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="dt">real</span> response[n];</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="dt">real</span> overall_mean;</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="dt">vector</span>[n_condition] condition_zoffset;</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; response_sd;</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; condition_mean_sd;</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>}</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="dt">vector</span>[n_condition] condition_mean;</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  condition_mean = overall_mean + condition_zoffset * condition_mean_sd;</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  response_sd ~ cauchy(<span class="dv">0</span>, <span class="dv">1</span>);         <span class="co">// =&gt; half-cauchy(0, 1)</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  condition_mean_sd ~ cauchy(<span class="dv">0</span>, <span class="dv">1</span>);   <span class="co">// =&gt; half-cauchy(0, 1)</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  overall_mean ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  condition_zoffset ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);   <span class="co">// =&gt; condition_mean ~ normal(overall_mean, condition_mean_sd)</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:n) {</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    response[i] ~ normal(condition_mean[condition[i]], response_sd);</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  }</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>}</span></code></pre></div>
<div class="section level3">
<h3 id="composing-data-for-input-to-model-compose_data">Composing data for input to model: <code>compose_data</code>
<a class="anchor" aria-label="anchor" href="#composing-data-for-input-to-model-compose_data"></a>
</h3>
<p>We have compiled and loaded this model into the variable <code>ABC_stan</code>. Rather than munge the data into a format Stan likes ourselves, we will use the <code><a href="reference/compose_data.html">tidybayes::compose_data()</a></code> function, which takes our <code>ABC</code> data frame and automatically generates a list of the following elements:</p>
<ul>
<li>
<code>n</code>: number of observations in the data frame</li>
<li>
<code>n_condition</code>: number of levels of the condition factor</li>
<li>
<code>condition</code>: a vector of integers indicating the condition of each observation</li>
<li>
<code>response</code>: a vector of observations</li>
</ul>
<p>So we can skip right to modeling:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span><span class="va">ABC_stan</span>, data <span class="op">=</span> <span class="fu"><a href="reference/compose_data.html">compose_data</a></span><span class="op">(</span><span class="va">ABC</span><span class="op">)</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-tidy-draws-from-the-model-spread_draws">Getting tidy draws from the model: <code>spread_draws</code>
<a class="anchor" aria-label="anchor" href="#getting-tidy-draws-from-the-model-spread_draws"></a>
</h3>
<p>We decorate the fitted model using <code><a href="reference/recover_types.html">tidybayes::recover_types()</a></code>, which will ensure that numeric indices (like <code>condition</code>) are back-translated back into factors when we extract data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="reference/recover_types.html">recover_types</a></span><span class="op">(</span><span class="va">ABC</span><span class="op">)</span></span></code></pre></div>
<p>Now we can extract variables of interest using <code>spread_draws</code>, which automatically parses indices, converts them back into their original format, and turns them into data frame columns. This function accepts a symbolic specification of Stan variables using the same syntax you would to index columns in Stan. For example, we can extract the condition means and the residual standard deviation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span>, <span class="va">response_sd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>  <span class="co"># just show the first few rows</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="do">## # A tibble: 15 × 6</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="do">## # Groups:   condition [1]</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="do">##    condition condition_mean .chain .iteration .draw response_sd</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="do">##    &lt;fct&gt;              &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="do">##  1 A                0.00544      1          1     1       0.576</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="do">##  2 A               -0.0836       1          2     2       0.576</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="do">##  3 A                0.0324       1          3     3       0.551</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="do">##  4 A                0.113        1          4     4       0.576</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="do">##  5 A                0.157        1          5     5       0.583</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="do">##  6 A                0.218        1          6     6       0.621</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="do">##  7 A                0.276        1          7     7       0.641</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="do">##  8 A                0.0130       1          8     8       0.637</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="do">##  9 A                0.152        1          9     9       0.609</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="do">## 10 A                0.192        1         10    10       0.521</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="do">## 11 A                0.154        1         11    11       0.558</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="do">## 12 A                0.298        1         12    12       0.552</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="do">## 13 A                0.349        1         13    13       0.531</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="do">## 14 A                0.471        1         14    14       0.566</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="do">## 15 A                0.313        1         15    15       0.568</span></span></code></pre></div>
<p>The condition numbers are automatically turned back into text (“A”, “B”, “C”, …) and split into their own column. A long-format data frame is returned with a row for every draw <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>×</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math> every combination of indices across all variables given to <code>spread_draws</code>; for example, because <code>response_sd</code> here is not indexed by <code>condition</code>, within the same draw it has the same value for each row corresponding to a different <code>condition</code> (some other formats supported by <code>tidybayes</code> are discussed in <code><a href="articles/tidybayes.html">vignette("tidybayes")</a></code>; in particular, the format returned by <code>gather_draws</code>).</p>
</div>
<div class="section level3">
<h3 id="plotting-posteriors-as-eye-plots-stat_eye">Plotting posteriors as eye plots: <code>stat_eye()</code>
<a class="anchor" aria-label="anchor" href="#plotting-posteriors-as-eye-plots-stat_eye"></a>
</h3>
<p>Automatic splitting of indices into columns makes it easy to plot the condition means here. We will employ the <code><a href="http://mjskay.github.io/ggdist/reference/stat_eye.html" class="external-link">ggdist::stat_eye()</a></code> geom, which combines a violin plot of the posterior density, median, 66% and 95% quantile interval to give an “eye plot” of the posterior. The point and interval types are customizable using the <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">point_interval()</a></code> family of functions. A “half-eye” plot (non-mirrored density) is also available as <code><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">ggdist::stat_halfeye()</a></code>. All tidybayes geometries automatically detect their appropriate orientation, though this can be overridden with the <code>orientation</code> parameter if the detection fails.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">condition_mean</span>, y <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_eye.html" class="external-link">stat_eye</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/stat_eye-1.png" width="672"></p>
<p>Or one can employ the similar “half-eye” plot:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">condition_mean</span>, y <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/stat_halfeye-1.png" width="672"></p>
<p>A variety of other stats and geoms for visualizing priors and posteriors are available; see <code><a href="http://mjskay.github.io/ggdist/articles/slabinterval.html" class="external-link">vignette("slabinterval", package = "ggdist")</a></code> for an overview of them.</p>
</div>
<div class="section level3">
<h3 id="plotting-posteriors-as-quantile-dotplots">Plotting posteriors as quantile dotplots<a class="anchor" aria-label="anchor" href="#plotting-posteriors-as-quantile-dotplots"></a>
</h3>
<p>Intervals are nice if the alpha level happens to line up with whatever decision you are trying to make, but getting a shape of the posterior is better (hence eye plots, above). On the other hand, making inferences from density plots is imprecise (estimating the area of one shape as a proportion of another is a hard perceptual task). Reasoning about probability in frequency formats is easier, motivating <a href="https://github.com/mjskay/when-ish-is-my-bus/blob/master/quantile-dotplots.md" class="external-link">quantile dotplots</a> (<a href="https://doi.org/10.1145/2858036.2858558" class="external-link">Kay et al. 2016</a>, <a href="https://doi.org/10.1145/3173574.3173718" class="external-link">Fernandes et al. 2018</a>), which also allow precise estimation of arbitrary intervals (down to the dot resolution of the plot, 100 in the example below).</p>
<p>Within the slabinterval family of geoms in tidybayes is the <code>dots</code> and <code>dotsinterval</code> family, which automatically determine appropriate bin sizes for dotplots and can calculate quantiles from samples to construct quantile dotplots. <code><a href="http://mjskay.github.io/ggdist/reference/stat_dots.html" class="external-link">ggdist::stat_dots()</a></code> is the variant designed for use on samples:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">condition_mean</span>, y <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_dots.html" class="external-link">stat_dots</a></span><span class="op">(</span>quantiles <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/README/quantile_dotplots-1.png" width="672"></p>
<p>The idea is to get away from thinking about the posterior as indicating one canonical point or interval, but instead to represent it as (say) 100 approximately equally likely points.</p>
</div>
<div class="section level3">
<h3 id="point-and-interval-summaries">Point and interval summaries<a class="anchor" aria-label="anchor" href="#point-and-interval-summaries"></a>
</h3>
<p>The functions <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">ggdist::median_qi()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">ggdist::mean_qi()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">ggdist::mode_hdi()</a></code>, etc (the <code>point_interval</code> functions) give tidy output of point summaries and intervals:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">median_qi</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="do">## # A tibble: 5 × 7</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="do">##   condition condition_mean .lower .upper .width .point .interval</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="do">##   &lt;fct&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="do">## 1 A                  0.199 -0.142  0.549   0.95 median qi       </span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="do">## 2 B                  1.01   0.651  1.34    0.95 median qi       </span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="do">## 3 C                  1.84   1.48   2.19    0.95 median qi       </span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="do">## 4 D                  1.02   0.681  1.37    0.95 median qi       </span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="do">## 5 E                 -0.890 -1.23  -0.529   0.95 median qi</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparison-to-other-models-via-compatibility-with-broom">Comparison to other models via compatibility with <code>broom</code>
<a class="anchor" aria-label="anchor" href="#comparison-to-other-models-via-compatibility-with-broom"></a>
</h3>
<p>Translation functions like <code><a href="http://mjskay.github.io/ggdist/reference/tidy-format-translators.html" class="external-link">ggdist::to_broom_names()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/tidy-format-translators.html" class="external-link">ggdist::from_broom_names()</a></code>, <code><a href="http://mjskay.github.io/ggdist/reference/tidy-format-translators.html" class="external-link">ggdist::to_ggmcmc_names()</a></code>, etc. can be used to translate between common tidy format data frames with different naming schemes. This makes it easy, for example, to compare points summaries and intervals between <code>tidybayes</code> output and models that are supported by <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy</a></code>.</p>
<p>For example, let’s compare against ordinary least squares (OLS) regression:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_results</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="va">condition</span>, data <span class="op">=</span> <span class="va">ABC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span></span>
<span><span class="va">linear_results</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="do">## # A tibble: 5 × 9</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="do">##   condition estimate std.error    df conf.low conf.high statistic  p.value model</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="do">## 1 A            0.182     0.173    45   -0.167     0.530      1.05 3.00e- 1 OLS  </span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="do">## 2 B            1.01      0.173    45    0.665     1.36       5.85 5.13e- 7 OLS  </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="do">## 3 C            1.87      0.173    45    1.53      2.22      10.8  4.15e-14 OLS  </span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="do">## 4 D            1.03      0.173    45    0.678     1.38       5.93 3.97e- 7 OLS  </span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="do">## 5 E           -0.935     0.173    45   -1.28     -0.586     -5.40 2.41e- 6 OLS</span></span></code></pre></div>
<p>Using <code><a href="http://mjskay.github.io/ggdist/reference/tidy-format-translators.html" class="external-link">ggdist::to_broom_names()</a></code>, we’ll convert the output from <code>median_qi</code> (which uses names <code>.lower</code> and <code>.upper</code>) to use names from <code>broom</code> (<code>conf.low</code> and <code>conf.high</code>) so that comparison with output from <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy</a></code> is easy:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayes_results</span> <span class="op">=</span> <span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html" class="external-link">median_qi</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">condition_mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/tidy-format-translators.html" class="external-link">to_broom_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Bayes"</span><span class="op">)</span></span>
<span><span class="va">bayes_results</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="do">## # A tibble: 5 × 8</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="do">##   condition estimate conf.low conf.high .width .point .interval model</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="do">##   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="do">## 1 A            0.199   -0.142     0.549   0.95 median qi        Bayes</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="do">## 2 B            1.01     0.651     1.34    0.95 median qi        Bayes</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="do">## 3 C            1.84     1.48      2.19    0.95 median qi        Bayes</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="do">## 4 D            1.02     0.681     1.37    0.95 median qi        Bayes</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="do">## 5 E           -0.890   -1.23     -0.529   0.95 median qi        Bayes</span></span></code></pre></div>
<p>This makes it easy to bind the two results together and plot them:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">linear_results</span>, <span class="va">bayes_results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">condition</span>, x <span class="op">=</span> <span class="va">estimate</span>, xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span>, color <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_pointinterval.html" class="external-link">geom_pointinterval</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/broom_bind-1.png" width="672"></p>
<p>Shrinkage towards the overall mean is visible in the Bayesian results.</p>
</div>
<div class="section level3">
<h3 id="posterior-prediction-and-complex-custom-plots">Posterior prediction and complex custom plots<a class="anchor" aria-label="anchor" href="#posterior-prediction-and-complex-custom-plots"></a>
</h3>
<p>The tidy data format returned by <code>spread_draws</code> also facilitates additional computation on variables followed by the construction of more complex custom plots. For example, we can generate posterior predictions easily, and use the <code>.width</code> argument (passed internally to <code>median_qi</code>) to generate any number of intervals from the posterior predictions, then plot them alongside point summaries and the data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">condition_mean</span><span class="op">[</span><span class="va">condition</span><span class="op">]</span>, <span class="va">response_sd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">condition_mean</span>, <span class="va">response_sd</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># posterior predictive intervals</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_interval.html" class="external-link">stat_interval</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prediction</span><span class="op">)</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># median and quantile intervals of condition mean</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">condition_mean</span><span class="op">)</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.66</span>, <span class="fl">.95</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html" class="external-link">position_nudge</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># data</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">response</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ABC</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/pp_intervals-1.png" width="672"></p>
<p>This plot shows 66% and 95% quantile credible intervals of posterior median for each condition (point + black line); 95%, 80%, and 50% posterior predictive intervals (blue); and the data.</p>
</div>
<div class="section level3">
<h3 id="fit-curves">Fit curves<a class="anchor" aria-label="anchor" href="#fit-curves"></a>
</h3>
<p>For models that support it (like <code>rstanarm</code> and <code>brms</code> models), We can also use the <code><a href="reference/add_predicted_draws.html">add_epred_draws()</a></code> or <code><a href="reference/add_predicted_draws.html">add_predicted_draws()</a></code> functions to generate distributions of posterior means or predictions. Combined with the functions from the <code>modelr</code> package, this makes it easy to generate fit curves.</p>
<p>Let’s fit a slightly naive model to miles per gallon versus horsepower in the <code>mtcars</code> dataset:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_mpg</span> <span class="op">=</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>, </span>
<span>  family <span class="op">=</span> <span class="va">lognormal</span>,</span>
<span></span>
<span>  file <span class="op">=</span> <span class="st">"README_models/m_mpg.rds"</span> <span class="co"># cache model (can be removed)  </span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we will use <code><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">modelr::data_grid</a></code>, <code><a href="reference/add_predicted_draws.html">tidybayes::add_predicted_draws()</a></code>, and <code><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">ggdist::stat_lineribbon()</a></code> to generate a fit curve with multiple probability bands:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html" class="external-link">seq_range</a></span><span class="op">(</span><span class="va">hp</span>, n <span class="op">=</span> <span class="fl">101</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/add_predicted_draws.html">add_predicted_draws</a></span><span class="op">(</span><span class="va">m_mpg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">stat_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.99</span>, <span class="fl">.95</span>, <span class="fl">.8</span>, <span class="fl">.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#08519C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/pp_bands-1.png" width="672"></p>
<p><code>ggdist::stat_lineribbon(aes(y = .prediction), .width = c(.99, .95, .8, .5))</code> is one of several shortcut geoms that simplify common combinations of <code>tidybayes</code> functions and <code>ggplot</code> geoms. It is roughly equivalent to the following:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.prediction</span>, fill <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">.width</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">.width</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    geom <span class="op">=</span> <span class="st">"ribbon"</span>, point_interval <span class="op">=</span> <span class="va">median_qi</span>, fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.99</span>, <span class="fl">.95</span>, <span class="fl">.8</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span>, fun.y <span class="op">=</span> <span class="va">median</span>, geom <span class="op">=</span> <span class="st">"line"</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span></span></code></pre></div>
<p>Because this is all tidy data, if you wanted to build a model with interactions among different categorical variables (say a different curve for automatic and manual transmissions), you can easily generate predictions faceted over that variable (say, different curves for different transmission types). Then you could use the existing faceting features built in to ggplot to plot them.</p>
<p>Such a model might be:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_mpg_am</span> <span class="op">=</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span> <span class="op">*</span> <span class="va">am</span>, </span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>, </span>
<span>  family <span class="op">=</span> <span class="va">lognormal</span>,</span>
<span></span>
<span>  file <span class="op">=</span> <span class="st">"README_models/m_mpg_am.rds"</span> <span class="co"># cache model (can be removed)  </span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we can generate and plot predictions as before (differences from above are highlighted as comments):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html" class="external-link">seq_range</a></span><span class="op">(</span><span class="va">hp</span>, n <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>, <span class="va">am</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>    <span class="co"># add am to the prediction grid</span></span>
<span>  <span class="fu"><a href="reference/add_predicted_draws.html">add_predicted_draws</a></span><span class="op">(</span><span class="va">m_mpg_am</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">stat_lineribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.99</span>, <span class="fl">.95</span>, <span class="fl">.8</span>, <span class="fl">.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#08519C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">am</span><span class="op">)</span>                                  <span class="co"># facet by am</span></span></code></pre></div>
<p><img src="reference/figures/README/pp_bands_facet-1.png" width="672"></p>
<p>Or, if you would like overplotted posterior fit lines, you can instead use <code><a href="reference/add_predicted_draws.html">tidybayes::add_epred_draws()</a></code> to get draws from conditional means (expectations of the posterior predictive, thus <code>epred</code>), select some reasonable number of them (say <code>ndraws = 100</code>), and then plot them:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html" class="external-link">seq_range</a></span><span class="op">(</span><span class="va">hp</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, <span class="va">am</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># NOTE: this shows the use of ndraws to subsample within add_epred_draws()</span></span>
<span>  <span class="co"># ONLY do this IF you are planning to make spaghetti plots, etc.</span></span>
<span>  <span class="co"># NEVER subsample to a small sample to plot intervals, densities, etc.</span></span>
<span>  <span class="fu"><a href="reference/add_predicted_draws.html">add_epred_draws</a></span><span class="op">(</span><span class="va">m_mpg_am</span>, ndraws <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>   <span class="co"># sample 100 means from the posterior</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.epred</span>, group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>, color <span class="op">=</span> <span class="st">"#08519C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">am</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/spaghetti-1.png" width="672"></p>
<p>Animated hypothetical outcome plots (HOPs) can also be easily constructed by using <code>gganimate</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">ndraws</span> <span class="op">=</span> <span class="fl">50</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html" class="external-link">seq_range</a></span><span class="op">(</span><span class="va">hp</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>, <span class="va">am</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># NOTE: this shows the use of ndraws to subsample within add_epred_draws()</span></span>
<span>  <span class="co"># ONLY do this IF you are planning to make spaghetti plots, etc.</span></span>
<span>  <span class="co"># NEVER subsample to a small sample to plot intervals, densities, etc.</span></span>
<span>  <span class="fu"><a href="reference/add_predicted_draws.html">add_epred_draws</a></span><span class="op">(</span><span class="va">m_mpg_am</span>, ndraws <span class="op">=</span> <span class="va">ndraws</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.epred</span>, group <span class="op">=</span> <span class="va">.draw</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#08519C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">am</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_states.html" class="external-link">transition_states</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/shadow_mark.html" class="external-link">shadow_mark</a></span><span class="op">(</span>past <span class="op">=</span> <span class="cn">TRUE</span>, future <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p</span>, nframes <span class="op">=</span> <span class="va">ndraws</span>, fps <span class="op">=</span> <span class="fl">2.5</span>, width <span class="op">=</span> <span class="fl">672</span>, height <span class="op">=</span> <span class="fl">480</span>, units <span class="op">=</span> <span class="st">"px"</span>, res <span class="op">=</span> <span class="fl">100</span>, dev <span class="op">=</span> <span class="st">"ragg_png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README/hops-1.gif"><!-- --></p>
<p>See <code><a href="articles/tidybayes.html">vignette("tidybayes")</a></code> for a variety of additional examples and more explanation of how it works.</p>
</div>
</div>
<div class="section level2">
<h2 id="feedback-issues-and-contributions">Feedback, issues, and contributions<a class="anchor" aria-label="anchor" href="#feedback-issues-and-contributions"></a>
</h2>
<p>I welcome feedback, suggestions, issues, and contributions! Contact me at <a href="mailto:mjskay@northwestern.edu" class="email">mjskay@northwestern.edu</a>. If you have found a bug, please file it <a href="https://github.com/mjskay/tidybayes/issues/new" class="external-link">here</a> with minimal code to reproduce the issue. Pull requests should be filed against the <a href="https://github.com/mjskay/tidybayes/tree/dev" class="external-link"><code>dev</code></a> branch.</p>
<p><code>tidybayes</code> grew out of helper functions I wrote to make my own analysis pipelines tidier. Over time it has expanded to cover more use cases I have encountered, but I would love to make it cover more!</p>
</div>
<div class="section level2">
<h2 id="citing-tidybayes">Citing <code>tidybayes</code>
<a class="anchor" aria-label="anchor" href="#citing-tidybayes"></a>
</h2>
<p>Matthew Kay (2024). <em>tidybayes: Tidy Data and Geoms for Bayesian Models</em>. R package version 3.0.7, <a href="https://mjskay.github.io/tidybayes/" class="uri">https://mjskay.github.io/tidybayes/</a>. DOI: <a href="https://doi.org/10.5281/zenodo.1308151" class="external-link">10.5281/zenodo.1308151</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=tidybayes" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mjskay/tidybayes/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mjskay/tidybayes/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tidybayes</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.mjskay.com" class="external-link">Matthew Kay</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.mjskay.com" class="external-link">Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
